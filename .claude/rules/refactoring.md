---
description: 리팩터링 원칙
alwaysApply: true
---

# 리팩터링 원칙

## 핵심 철학

### 리팩터링의 목적

리팩터링은 **외부 동작을 유지**하면서 **내부 구조를 개선**하는 것이다. 목적 없는 리팩터링은 위험하다.

**올바른 리팩터링 동기:**

- 새 기능 추가가 어려울 때 (확장성)
- 버그 수정이 다른 버그를 유발할 때 (유지보수성)
- 코드 이해에 시간이 오래 걸릴 때 (가독성)
- 같은 변경이 여러 곳에서 필요할 때 (DRY)

## SRP (단일 책임 원칙)

### 컴포넌트 책임 분리

컴포넌트가 **하나의 변경 이유**만 가지도록 설계한다.

**분리 신호:**

- 150줄 이상
- "그리고"로 설명되는 기능 ("필터를 보여주고 **그리고** URL을 관리한다")
- 서로 다른 이유로 변경되는 코드가 공존

**책임 분리 방향:**

```
UI 렌더링 ← 컴포넌트의 유일한 책임
상태 관리 → 훅 또는 상위 컴포넌트로
비즈니스 로직 → 별도 함수/훅으로
부수 효과 → 훅으로
```

### 함수 책임 분리

- 20줄 이상이면 분리 검토
- 함수명이 역할을 완전히 설명해야 함
- "~하고 ~한다"면 분리 대상

## DRY (반복 금지)

### 컴포넌트 통합

**통합해야 하는 신호:**

- 90% 이상 코드 중복
- 복사-붙여넣기로 만들어진 컴포넌트
- 이름만 다른 거의 동일한 구조

**통합 전략:**

1. 공통 부분을 기본 동작으로
2. 차이점을 optional props로 추출
3. 조건부 렌더링으로 분기

```typescript
// 차이점을 props로 추상화
interface Props {
  onPrimary: () => void;      // 공통
  onSecondary?: () => void;   // 선택적 기능
  variant?: 'strict' | 'flexible';  // 동작 분기
}
```

### 로직 추출

**추출 기준:**

- 2회 이상 반복되는 로직
- 여러 컴포넌트에서 사용되는 상태 패턴
- 복잡한 계산/변환 로직

**추출 위치:**

| 로직 유형 | 추출 위치 |
|----------|----------|
| 상태 + 부수효과 | 커스텀 훅 |
| 순수 계산/변환 | 유틸 함수 |
| 타입 정의 | `model/types.ts` |

## 의존성 역전 (DIP)

### 컴포넌트 의존성

컴포넌트는 **구체적인 구현**이 아닌 **추상화(props)**에 의존해야 한다.

```typescript
// BAD: 구체적 구현에 의존
function Component() {
  const data = useSpecificStore();  // 특정 store에 강결합
  const router = useRouter();       // Next.js에 강결합
}

// GOOD: 추상화(props)에 의존
function Component({ data, onNavigate }) {
  // 어디서 데이터가 오는지, 어디로 이동하는지 모름
  // → 재사용 가능, 테스트 용이
}
```

**장점:**

- **테스트**: 모킹 없이 props만으로 테스트
- **재사용**: 다양한 컨텍스트에서 사용 가능
- **유연성**: 상태 소스 변경 시 컴포넌트 수정 불필요

## FSD 레이어 이동

| 이동 조건 | From → To |
|----------|-----------|
| 2곳 이상에서 사용되는 유틸 | 컴포넌트 → `shared/lib/` |
| 복잡한 상태 관리 추가 | features → widgets |
| 여러 파일에서 사용되는 타입 | 컴포넌트 → `model/types.ts` |
| 비즈니스 엔티티 표현 | features → entities |

## 리팩터링 안전 장치

### Before

- 기존 동작을 이해하고 문서화
- 테스트가 있다면 통과 확인
- 영향 범위 파악 (import 추적)

### After

- 빌드 성공 확인
- 기존 기능 동작 확인
- 삭제된 export 정리
- 스토리북 정상 동작 확인

### 점진적 리팩터링

한 번에 너무 많이 바꾸지 않는다. 작은 단위로 나누어:

1. 하나의 관심사만 변경
2. 빌드/테스트 확인
3. 커밋
4. 다음 변경으로
